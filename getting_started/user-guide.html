<!DOCTYPE html>
<html class="writer-html4" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>User Guide &mdash; Django River ML 0.0.18 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/sphinx-argparse.css" type="text/css" />
      <link rel="stylesheet" href="../_static/theme.css" type="text/css" />
    <link rel="shortcut icon" href="../_static/favicon.ico"/>
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Django River ML Python Module" href="../api_reference/django-river-ml.html" />
    <link rel="prev" title="Installation" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> Django River ML
          </a>
              <div class="version">
                0.0.18
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting started</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="index.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">User Guide</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#quick-start">Quick Start</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#setup">Setup</a></li>
<li class="toctree-l3"><a class="reference internal" href="#settings">Settings</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#custom-models">Custom Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="#api-views-enabled">API Views Enabled</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#authentication">Authentication</a></li>
<li class="toctree-l3"><a class="reference internal" href="#sample-application">Sample Application</a></li>
<li class="toctree-l3"><a class="reference internal" href="#testing">Testing</a></li>
<li class="toctree-l3"><a class="reference internal" href="#interaction-from-inside-your-application">Interaction from Inside your Application</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#get-models">Get Models</a></li>
<li class="toctree-l4"><a class="reference internal" href="#create-a-model">Create a Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#delete-a-model">Delete a Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#get-model">Get Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#stats-and-metrics-for-a-model">Stats and Metrics for a Model</a></li>
<li class="toctree-l4"><a class="reference internal" href="#interactive-learn">Interactive Learn</a></li>
<li class="toctree-l4"><a class="reference internal" href="#interactive-label">Interactive Label</a></li>
<li class="toctree-l4"><a class="reference internal" href="#interactive-predict">Interactive Predict</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/django-river-ml.html">Django River ML Python Module</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api_reference/internal/modules.html">Internal API</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Django River ML</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Getting Started</a> &raquo;</li>
      <li>User Guide</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/getting_started/user-guide.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <div class="section" id="user-guide">
<span id="getting-started-user-guide"></span><h1>User Guide<a class="headerlink" href="#user-guide" title="Permalink to this headline">ÔÉÅ</a></h1>
<p>Django River ML allows you to easily deploy <a class="reference external" href="https://riverml.xyz">river</a> online machine learning
for a <a class="reference external" href="https://www.djangoproject.com/">Django</a> project. It is based off of <a class="reference external" href="https://github.com/online-ml/chantilly">chantilly</a>
with hopes of having similar design. We include <a class="reference external" href="https://github.com/vsoch/django-river-ml/tree/main/examples">example clients</a> and a
test application in <a class="reference external" href="https://github.com/vsoch/django-river-ml/tree/main/tests">tests</a>.
We are excited about what you might build with this, and please
<a class="reference external" href="https://github.com/vsoch/django-river-ml/issues">give us a ping</a>. if you have a question, find a bug, or want to request a feature!
This is an open source project and we are eager for your contribution. üéâÔ∏è</p>
<div class="section" id="quick-start">
<h2>Quick Start<a class="headerlink" href="#quick-start" title="Permalink to this headline">ÔÉÅ</a></h2>
<p>Once you have <code class="docutils literal notranslate"><span class="pre">django-river-ml</span></code> installed (<a class="reference internal" href="installation.html#getting-started-installation"><span class="std std-ref">Installation</span></a>) you
can do basic setup.</p>
<div class="section" id="setup">
<h3>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>Add it to your <code class="docutils literal notranslate"><span class="pre">INSTALLED_APPS</span></code> along with <code class="docutils literal notranslate"><span class="pre">rest_framework</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">INSTALLED_APPS</span> <span class="o">=</span> <span class="p">(</span>
    <span class="o">...</span>
    <span class="s1">&#39;django_river_ml&#39;</span><span class="p">,</span>
    <span class="s1">&#39;rest_framework&#39;</span><span class="p">,</span>
    <span class="o">...</span>
<span class="p">)</span>
</pre></div>
</div>
<p>Add django-river-ml‚Äôs URL patterns:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django_river_ml</span> <span class="kn">import</span> <span class="n">urls</span> <span class="k">as</span> <span class="n">django_river_urls</span>
<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;^&#39;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="n">django_river_urls</span><span class="p">)),</span>
    <span class="o">...</span>
<span class="p">]</span>
</pre></div>
</div>
<p>If you use something like <a class="reference external" href="https://django-rest-swagger.readthedocs.io/en/latest/">Django Rest Swagger</a>
for yur API documentation, registering the <code class="docutils literal notranslate"><span class="pre">django_river_urls</span></code> alongside your app should render
the endpoints nicely in the user interface! E.g., to extend the above, we might have a set of
API views (to show up in docs) and server views (to not show up):</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django_river_ml</span> <span class="kn">import</span> <span class="n">urls</span> <span class="k">as</span> <span class="n">django_river_urls</span>

<span class="kn">from</span> <span class="nn">rest_framework_swagger.views</span> <span class="kn">import</span> <span class="n">get_swagger_view</span>
<span class="n">schema_view</span> <span class="o">=</span> <span class="n">get_swagger_view</span><span class="p">(</span><span class="n">title</span><span class="o">=</span><span class="s2">&quot;Spack Monitor API&quot;</span><span class="p">)</span>

<span class="n">server_views</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^api/docs/&quot;</span><span class="p">,</span> <span class="n">schema_view</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;docs&quot;</span><span class="p">),</span>
<span class="p">]</span>

<span class="n">urlpatterns</span> <span class="o">=</span> <span class="p">[</span>
    <span class="o">...</span>
    <span class="n">path</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="n">include</span><span class="p">(</span><span class="s2">&quot;django_river_ml.urls&quot;</span><span class="p">,</span> <span class="n">namespace</span><span class="o">=</span><span class="s2">&quot;django_river_ml&quot;</span><span class="p">)),</span>
    <span class="n">url</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;^&quot;</span><span class="p">,</span> <span class="n">include</span><span class="p">((</span><span class="n">server_views</span><span class="p">,</span> <span class="s2">&quot;api&quot;</span><span class="p">),</span> <span class="n">namespace</span><span class="o">=</span><span class="s2">&quot;internal_apis&quot;</span><span class="p">)),</span>
    <span class="o">...</span>
<span class="p">]</span>
</pre></div>
</div>
<p>And this will render the Django River ML API alongside your other API prefixes. For example,
here is Django River ML deployed under ‚Äúml‚Äù:</p>
<img alt="An example of Django River ML with ``URL_PREFIX`` &quot;ml&quot; showing up in the API docs" src="../_images/schema-view.png" />
</div>
<div class="section" id="settings">
<h3>Settings<a class="headerlink" href="#settings" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>It is highly recommended that you minimally set these settings in your app settings.py
and do not use the default of the plugin:</p>
<table border="1" class="docutils" id="id1">
<caption><span class="caption-text">Title</span><a class="headerlink" href="#id1" title="Permalink to this table">ÔÉÅ</a></caption>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Default</th>
<th class="head">Description</th>
<th class="head">Example</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">APP_DIR</span></code></td>
<td>$root</td>
<td>Base directory for storing secrets and cache. Defaults to the root of the module installation (recommended to change)</td>
<td><code class="docutils literal notranslate"><span class="pre">os.path.dirname(os.path.abspath(__file__))</span></code></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">SHELVE_SECRET_KEY</span></code></td>
<td>None</td>
<td>Secret key for shelve (if <code class="docutils literal notranslate"><span class="pre">STORAGE_BACKEND</span></code> set to ‚Äúshelve‚Äù (will be generated if not found)</td>
<td>fgayudsiushfdsfdf</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">JWT_SECRET_KEY</span></code></td>
<td>None</td>
<td>Secret key for json web tokens (if authentication enabled, and will be generated if not found)</td>
<td>fgayudsiushfdsfdf</td>
</tr>
</tbody>
</table>
<p>The following additonal settings are available to set in your <code class="docutils literal notranslate"><span class="pre">settings.py</span></code>:</p>
<table border="1" class="docutils" id="id2">
<caption><span class="caption-text">Title</span><a class="headerlink" href="#id2" title="Permalink to this table">ÔÉÅ</a></caption>
<colgroup>
<col width="25%" />
<col width="25%" />
<col width="25%" />
<col width="25%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">Name</th>
<th class="head">Default</th>
<th class="head">Description</th>
<th class="head">Example</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">URL_PREFIX</span></code></td>
<td>api</td>
<td>The api prefix to use for the endpoint</td>
<td>river</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">STORAGE_BACKEND</span></code></td>
<td>shelve</td>
<td>The storage backend to use, either shelve or redis (requires redis setup)</td>
<td>redis</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">REDIS_DB</span></code></td>
<td>river-redis</td>
<td>The redis database name, only used if <code class="docutils literal notranslate"><span class="pre">STORAGE_BACKEND</span></code> is set to redis</td>
<td>another-name</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">REDIS_HOST</span></code></td>
<td>localhost</td>
<td>The redis host name, only used if <code class="docutils literal notranslate"><span class="pre">STORAGE_BACKEND</span></code> is set to redis</td>
<td>redis-container</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">REDIS_PORT</span></code></td>
<td>6379</td>
<td>The redis port, only used if <code class="docutils literal notranslate"><span class="pre">STORAGE_BACKEND</span></code> is set to redis</td>
<td>1111</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">CACHE_DIR</span></code></td>
<td>None (and then is set to <code class="docutils literal notranslate"><span class="pre">os.path.join(APP_DIR,</span> <span class="pre">&quot;cache&quot;)</span></code>)</td>
<td>The cache directory for tokens, recommended to set a custom <code class="docutils literal notranslate"><span class="pre">APP_DIR</span></code> and it will be a sub-directory <code class="docutils literal notranslate"><span class="pre">cache</span></code> there</td>
<td>/opt/cache</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">GENERATE_IDENTIFIERS</span></code></td>
<td>True</td>
<td>Always generate identifiers for predictions. If False, you can still provide an identifier to the predict endpoint to use.</td>
<td>True</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">DISABLE_AUTHENTICATION</span></code></td>
<td>True</td>
<td>For views that require authentication, disable them.</td>
<td>True</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">DOMAIN_URL</span></code></td>
<td><a class="reference external" href="http://127.0.0.1:8000">http://127.0.0.1:8000</a></td>
<td>Domain used in templates, and api prefix</td>
<td><a class="reference external" href="https://ml-server">https://ml-server</a></td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">SESSION_EXPIRES_SECONDS</span></code></td>
<td>600</td>
<td>The number of seconds a session (upload request) is valid (10 minutes)</td>
<td>6000</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">TOKEN_EXPIRES_SECONDS</span></code></td>
<td>600</td>
<td>The number of seconds a token is valid (10 minutes)</td>
<td>6000</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">VIEW_RATE_LIMIT</span></code></td>
<td>10000/1day</td>
<td>View rate limit using django-ratelimit based on ipaddress</td>
<td>100/1day</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">VIEW_RATE_LIMIT_BLOCK</span></code></td>
<td>True</td>
<td>Given that someone goes over, are they blocked for a period?</td>
<td>False</td>
</tr>
<tr class="row-odd"><td><code class="docutils literal notranslate"><span class="pre">VIEW_RATE_LIMIT_DISABLE</span></code></td>
<td>True</td>
<td>Globally disable rate limiting (ideal for development or for a heavily used learning server)</td>
<td>False</td>
</tr>
<tr class="row-even"><td><code class="docutils literal notranslate"><span class="pre">API_VIEWS_ENABLED</span></code></td>
<td><code class="docutils literal notranslate"><span class="pre">[]</span></code></td>
<td>Provide a list of view names (strings) to enable. If not set (empty list or None) all are enabled.</td>
<td><code class="docutils literal notranslate"><span class="pre">['predict',</span> <span class="pre">'service_info',</span> <span class="pre">'metrics',</span> <span class="pre">'models',</span> <span class="pre">'model_download',</span> <span class="pre">'stats']</span></code></td>
</tr>
</tbody>
</table>
<div class="section" id="custom-models">
<h4>Custom Models<a class="headerlink" href="#custom-models" title="Permalink to this headline">ÔÉÅ</a></h4>
<p>Django River ML has support for custom models, where a custom model is one you‚Äôve defined in your application
to use with river. In order for this to work, you will need to define your model somewhere
in your app so it is importable across Django apps (e.g., and when Django River ML tries to unpickle
a model object of that type, it will be found). If needed, we can further define a custom
set of classes in settings that can be looked for via importlib, however the simple
approch to define it in your app or otherwise install a module that makes it importable is
suggested.</p>
<p>Custom models currently support stats but not metrics, and metrics could be supported
if we think about how to go about it. the <code class="docutils literal notranslate"><span class="pre">CustomModel</span></code> flavor is designed to be mostly
forgiving to allow you to choose any prediction function you might have, and we can extend this
if needed.</p>
</div>
<div class="section" id="api-views-enabled">
<h4>API Views Enabled<a class="headerlink" href="#api-views-enabled" title="Permalink to this headline">ÔÉÅ</a></h4>
<p>If you want to disable some views, you can set of a list of views to enable using
<code class="docutils literal notranslate"><span class="pre">API_VIEWS_ENABLED</span></code>. As an example, let‚Äôs say we are going to have learning
done internally, and we just want to expose metadata and prediction endpoints.
We could do:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">DJANGO_RIVER_ML</span> <span class="o">=</span> <span class="p">{</span>
    <span class="o">...</span>
    <span class="c1"># Only allow these API views</span>
    <span class="s2">&quot;API_VIEWS_ENABLED&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;predict&#39;</span><span class="p">,</span> <span class="s1">&#39;service_info&#39;</span><span class="p">,</span> <span class="s1">&#39;metrics&#39;</span><span class="p">,</span> <span class="s1">&#39;models&#39;</span><span class="p">,</span> <span class="s1">&#39;model_download&#39;</span><span class="p">,</span> <span class="s1">&#39;stats&#39;</span><span class="p">]</span>
    <span class="o">...</span>
<span class="p">}</span>
</pre></div>
</div>
<p>The views to choose from include:</p>
<blockquote>
<div><ul class="simple">
<li>auth_token</li>
<li>service_info</li>
<li>learn</li>
<li>predict</li>
<li>label</li>
<li>metrics</li>
<li>stream_metrics</li>
<li>stream_events</li>
<li>stats</li>
<li>model_download</li>
<li>model</li>
<li>models</li>
</ul>
</div></blockquote>
<p>Note that ‚Äúmodel‚Äù includes most interactions to create or get a model.</p>
<p>For more advanced settings like customizing the endpoints with authentication, see
the <a class="reference external" href="https://github.com/vsoch/django-river-ml/blob/main/django_river_ml/settings.py">settings.py</a> in the application.</p>
</div>
</div>
<div class="section" id="authentication">
<h3>Authentication<a class="headerlink" href="#authentication" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>If you have <code class="docutils literal notranslate"><span class="pre">DISABLE_AUTHENTICATION</span></code> set to true, or you customize the settings <code class="docutils literal notranslate"><span class="pre">AUTHENTICATED_VIEWS</span></code> to change
the defaults, then you shouldn‚Äôt need to do any kind of authentication. This might be ideal for a development or
closed environment that is only accessible to you or your team. However, for most cases you are strongly encouraged to
have authentication. Authentication will require creating a user, to which Django River ML will add a token generated
by Django Restful, if not already generated. For purposes of example, we can quickly create a user as follows:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">python manage.py createsuperuser</span>
<span class="go">Username (leave blank to use &#39;dinosaur&#39;):</span>
<span class="go">Email address:</span>
<span class="go">Password:</span>
<span class="go">Password (again):</span>
<span class="go">Superuser created successfully.</span>
</pre></div>
</div>
<p>And at this point, you can also ask for the token.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">python manage.py get_token dinosaur</span>
<span class="go">Enter Password:</span>
<span class="go">xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span>
</pre></div>
</div>
<p>You can then export this token in the environment to be found by the <a class="reference external" href="https://github.com/vsoch/riverapi">river api client</a>.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export RIVER_ML_USER=dinosaur</span>
<span class="go">export RIVER_ML_TOKEN=xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span>
</pre></div>
</div>
<p>Otherwise you will need to manually go through a standard OAuth2 workflow of using basic
auth to look for a 401 response with a <code class="docutils literal notranslate"><span class="pre">Www-Authenticate</span></code> header, parsing that to find the ‚Äúrealm‚Äù
(the authentication server) and then making a request to that endpoint with the base64 encoded user and token
in the Authenticate header. It‚Äôs much easier to use the client to do it for you, which will cache your token
(until it expires and you need to request a new one automatically).</p>
<p>Of course if you have a Django interface with OAuth for login, you can make a settings
or profile page to easily retrieve the same token. Open an issue if you need guidance to do this.
We might consider adding a front-end view to provide by default if it‚Äôs desired.</p>
</div>
<div class="section" id="sample-application">
<h3>Sample Application<a class="headerlink" href="#sample-application" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>An <a class="reference external" href="https://github.com/vsoch/django-river-ml/tree/main/tests">example app</a> is provided that
you can use to test. Once you have your environment setup, you can do:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python manage.py makemigrations
<span class="gp">$ </span>python manage.py migrate
<span class="gp">$ </span>python manage.py runserver
</pre></div>
</div>
<p>In another terminal, you can then run a sample script:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>python examples/regression/run.py
<span class="gp">$ </span>python examples/binary/run.py
<span class="gp">$ </span>python examples/multiclass/run.py
<span class="gp">$ </span>python examples/cluster/run.py
<span class="gp">$ </span>python examples/custom/run.py
</pre></div>
</div>
</div>
<div class="section" id="testing">
<h3>Testing<a class="headerlink" href="#testing" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>Running tests with the example server is also fairly easy!</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">python runtests.py</span>
</pre></div>
</div>
</div>
<div class="section" id="interaction-from-inside-your-application">
<h3>Interaction from Inside your Application<a class="headerlink" href="#interaction-from-inside-your-application" title="Permalink to this headline">ÔÉÅ</a></h3>
<p>While a user is going to be interacting with your API endpoints, you might want to
interact with models from within your Django application. This is possible
by interacting with the <code class="docutils literal notranslate"><span class="pre">DjangoClient</span></code> directly, which wraps the database
and is exposed to the API via a light additional wrapper. The following examples can walk
you through the different kinds of interactions. For all interactions, you‚Äôll
wait to create a client first:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">django_river_ml.client</span> <span class="kn">import</span> <span class="n">DjangoClient</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">DjangoClient</span><span class="p">()</span>
</pre></div>
</div>
<p>This also means you can choose to not add the Django River URLs to your application
and have more control over your ML interactions internally. You can also take an approach
between those two extremes, and just expose a limited set using the <code class="docutils literal notranslate"><span class="pre">API_VIEWS_ENABLED</span></code>
setting. When empty, all views are enabled. Otherwise, you can set a custom set of names to
enable (and those not in the list will not be enabled).</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">We are planning to allow retrieving a model from version control, e.g., given that
you are starting a Kubernetes run of Spack Monitor (which will need to use redis to store
model information) and the model is not found.</p>
</div>
<div class="section" id="get-models">
<h4>Get Models<a class="headerlink" href="#get-models" title="Permalink to this headline">ÔÉÅ</a></h4>
<p>To get models, simply ask for them! This will return a list of names to interact
with further.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">client</span><span class="o">.</span><span class="n">models</span><span class="p">()</span>
<span class="p">[</span><span class="s1">&#39;milky-despacito&#39;</span><span class="p">,</span> <span class="s1">&#39;tart-bicycle&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="section" id="create-a-model">
<h4>Create a Model<a class="headerlink" href="#create-a-model" title="Permalink to this headline">ÔÉÅ</a></h4>
<p>If you want your server to create some initial model (as opposed to allowing users
to upload them) you can easily do that:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">river</span> <span class="kn">import</span> <span class="n">feature_extraction</span><span class="p">,</span> <span class="n">cluster</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;peanut-butter-clusters&quot;</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">feature_extraction</span><span class="o">.</span><span class="n">BagOfWords</span><span class="p">()</span> <span class="o">|</span> <span class="n">cluster</span><span class="o">.</span><span class="n">KMeans</span><span class="p">(</span>
    <span class="n">n_clusters</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">halflife</span><span class="o">=</span><span class="mf">0.4</span><span class="p">,</span> <span class="n">sigma</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">seed</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">model_name</span><span class="p">)</span>
</pre></div>
</div>
<p>You could also do the same from file, meaning a pickled model you‚Äôve created elsewhere.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pickle</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="s2">&quot;peanut-butter-clusters&quot;</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.pkl&#39;</span> <span class="o">%</span> <span class="n">model_name</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
    <span class="n">model</span> <span class="o">=</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">model_name</span><span class="p">)</span>
</pre></div>
</div>
<p>Or if your application has automatically created an ‚Äúempty‚Äù model with your desired name (the default when enabled), you can delete it first and do the same.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">client</span><span class="o">.</span><span class="n">delete_model</span><span class="p">(</span><span class="n">model_name</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">pickle</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">%s</span><span class="s1">.pkl&#39;</span> <span class="o">%</span> <span class="n">model_name</span><span class="p">,</span> <span class="s1">&#39;rb&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">fd</span><span class="p">:</span>
    <span class="n">model</span> <span class="n">pickle</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">fd</span><span class="p">)</span>
<span class="n">model_name</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">add_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;cluster&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="n">model_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="delete-a-model">
<h4>Delete a Model<a class="headerlink" href="#delete-a-model" title="Permalink to this headline">ÔÉÅ</a></h4>
<p>You can delete a model by name.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">client</span><span class="o">.</span><span class="n">delete_model</span><span class="p">(</span><span class="s2">&quot;tart-bicycle&quot;</span><span class="p">)</span>
<span class="kc">True</span>
</pre></div>
</div>
</div>
<div class="section" id="get-model">
<h4>Get Model<a class="headerlink" href="#get-model" title="Permalink to this headline">ÔÉÅ</a></h4>
<p>Of course to retrieve the model directly, you can do:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">model</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">get_model</span><span class="p">(</span><span class="s2">&quot;spack-errors&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Keep in mind you are holding onto the model in memory and will need to again save it.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">client</span><span class="o">.</span><span class="n">save_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;spack-errors&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that if you are doing standard predict or learn endpoints, you can simply
provide the model name and you don‚Äôt need to worry about retrieving or saving
(the function handles it for you!)</p>
</div>
<div class="section" id="stats-and-metrics-for-a-model">
<h4>Stats and Metrics for a Model<a class="headerlink" href="#stats-and-metrics-for-a-model" title="Permalink to this headline">ÔÉÅ</a></h4>
<p>The one drawback of uploading a model is that you won‚Äôt have stats or metrics populated.
You simply cannot, given that the learning happened elsewhere, and is normally done on the
server to get these metrics. However, once you‚Äôve done more learning you can ask for stats or
metrics:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">client</span><span class="o">.</span><span class="n">stats</span><span class="p">(</span><span class="s2">&quot;spack-errors&quot;</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">metrics</span><span class="p">(</span><span class="s2">&quot;spack-errors&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="interactive-learn">
<h4>Interactive Learn<a class="headerlink" href="#interactive-learn" title="Permalink to this headline">ÔÉÅ</a></h4>
<p>You‚Äôll generally need to provide the model name and features, although if you provide
an identifier these things can be looked up.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">client</span><span class="o">.</span><span class="n">learn</span><span class="p">(</span>
    <span class="n">model_name</span><span class="p">,</span>
    <span class="n">ground_truth</span><span class="o">=</span><span class="n">ground_truth</span><span class="p">,</span>
    <span class="n">prediction</span><span class="o">=</span><span class="n">prediction</span><span class="p">,</span>
    <span class="n">features</span><span class="o">=</span><span class="n">features</span><span class="p">,</span>
    <span class="n">identifier</span><span class="o">=</span><span class="n">identifier</span><span class="p">,</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="interactive-label">
<h4>Interactive Label<a class="headerlink" href="#interactive-label" title="Permalink to this headline">ÔÉÅ</a></h4>
<p>To do a labeling (post learn) you‚Äôll need to provide the label, the identifier,
and the model name.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">client</span><span class="o">.</span><span class="n">label</span><span class="p">(</span><span class="n">label</span><span class="p">,</span> <span class="n">identifier</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="interactive-predict">
<h4>Interactive Predict<a class="headerlink" href="#interactive-predict" title="Permalink to this headline">ÔÉÅ</a></h4>
<p>A prediction usually needs the model name and features, and optionally an identifier.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">client</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">identifier</span><span class="p">)</span>
</pre></div>
</div>
<p>The remainder of functions on the client are used internally and you should not need to call them
directly. This library is under development and we will have more endpoints and functionality
coming soon!</p>
</div>
</div>
</div>
</div>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="Installation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../api_reference/django-river-ml.html" class="btn btn-neutral float-right" title="Django River ML Python Module" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Vanessa Sochat.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>